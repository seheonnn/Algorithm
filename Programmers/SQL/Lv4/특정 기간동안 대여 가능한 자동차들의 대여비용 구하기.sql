SELECT C.CAR_ID, C.CAR_TYPE, ROUND((C.DAILY_FEE * (1 - P.DISCOUNT_RATE / 100) * 30)) AS FEE
FROM
(SELECT *
FROM CAR_RENTAL_COMPANY_CAR
WHERE (CAR_TYPE = '세단' OR CAR_TYPE = 'SUV') AND CAR_ID NOT IN (SELECT CAR_ID
FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
# WHERE ('2022-11-01' < START_DATE AND START_DATE < '2022-11-30')
# OR ('2022-11-01' < END_DATE AND END_DATE < '2022-11-30')
# OR (START_DATE < '2022-11-01' AND '2022-11-30' < END_DATE)
WHERE (START_DATE BETWEEN '2022-11-01' AND '2022-11-30')
OR (END_DATE BETWEEN '2022-11-01' AND '2022-11-30')
OR (START_DATE < '2022-11-01' AND END_DATE > '2022-11-30')
)) AS C
LEFT JOIN CAR_RENTAL_COMPANY_DISCOUNT_PLAN AS P
ON P.CAR_TYPE = C.CAR_TYPE
WHERE P.DURATION_TYPE = '30일 이상'
AND (500000 <= (C.DAILY_FEE * (1 - P.DISCOUNT_RATE / 100) * 30) AND (C.DAILY_FEE * (1 - P.DISCOUNT_RATE / 100) * 30) < 2000000)
ORDER BY FEE DESC, CAR_TYPE ASC, CAR_ID DESC